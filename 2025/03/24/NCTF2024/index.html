<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"languag3.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":true,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="因为一些小细节导致中午就打通的绮云一直到晚上才过了远程&#x2F;(ㄒoㄒ)&#x2F;~~，以至于后面心态有点炸了到了第二天晚上才做完前面3题。 故障注入那块是真没研究过只能先搁着了(●&#39;◡&#39;●)">
<meta property="og:type" content="article">
<meta property="og:title" content="NCTF2024">
<meta property="og:url" content="https://languag3.github.io/2025/03/24/NCTF2024/index.html">
<meta property="og:site_name" content="languag3">
<meta property="og:description" content="因为一些小细节导致中午就打通的绮云一直到晚上才过了远程&#x2F;(ㄒoㄒ)&#x2F;~~，以至于后面心态有点炸了到了第二天晚上才做完前面3题。 故障注入那块是真没研究过只能先搁着了(●&#39;◡&#39;●)">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-03-24T10:23:27.000Z">
<meta property="article:modified_time" content="2025-03-24T10:29:14.188Z">
<meta property="article:author" content="languag3">
<meta property="article:tag" content="ctf">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://languag3.github.io/2025/03/24/NCTF2024/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://languag3.github.io/2025/03/24/NCTF2024/","path":"2025/03/24/NCTF2024/","title":"NCTF2024"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>NCTF2024 | languag3</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">languag3</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">众里寻他千百度。蓦然回首，那人却在，灯火阑珊处。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-link"><a href="/links/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>友链</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%AE%E4%BA%91"><span class="nav-number">1.</span> <span class="nav-text"> 绮云</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sign"><span class="nav-number">2.</span> <span class="nav-text"> Sign</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#arcahv"><span class="nav-number">3.</span> <span class="nav-text"> Arcahv</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="languag3"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">languag3</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/languag3" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;languag3" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1499304232@qq.com" title="E-Mail → mailto:1499304232@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://languag3.github.io/2025/03/24/NCTF2024/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="languag3">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="languag3">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="NCTF2024 | languag3">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          NCTF2024
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-03-24 18:23:27 / 修改时间：18:29:14" itemprop="dateCreated datePublished" datetime="2025-03-24T18:23:27+08:00">2025-03-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>因为一些小细节导致中午就打通的<strong>绮云</strong>一直到晚上才过了远程/(ㄒoㄒ)/~~，以至于后面心态有点炸了到了第二天晚上才做完前面3题。</p>
<p>故障注入那块是真没研究过只能先搁着了(●'◡'●)</p>
<span id="more"></span> 
<h3 id="绮云"><a class="markdownIt-Anchor" href="#绮云"></a> 绮云</h3>
<p>题目</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> getenv,urandom</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ECDSA</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.p = <span class="number">0xFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFF</span></span><br><span class="line">        <span class="variable language_">self</span>.a = <span class="number">0xFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC</span></span><br><span class="line">        <span class="variable language_">self</span>.b = <span class="number">0x28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93</span></span><br><span class="line">        <span class="variable language_">self</span>.n = <span class="number">0xFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123</span></span><br><span class="line">        <span class="variable language_">self</span>.Gx = <span class="number">0x32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7</span></span><br><span class="line">        <span class="variable language_">self</span>.Gy = <span class="number">0xBC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0</span></span><br><span class="line">        <span class="variable language_">self</span>.G = (<span class="variable language_">self</span>.Gx,<span class="variable language_">self</span>.Gy)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.d = getPrime(<span class="number">232</span>)</span><br><span class="line">        <span class="variable language_">self</span>.Q = <span class="variable language_">self</span>.mul(<span class="variable language_">self</span>.d,<span class="variable language_">self</span>.G)</span><br><span class="line">        <span class="keyword">assert</span> <span class="variable language_">self</span>.is_on_curve(<span class="variable language_">self</span>.Q)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_on_curve</span>(<span class="params">self, point</span>):</span><br><span class="line">        <span class="keyword">if</span> point <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        x, y = point</span><br><span class="line">        <span class="keyword">return</span> (y**<span class="number">2</span> - x**<span class="number">3</span> - <span class="variable language_">self</span>.a * x - <span class="variable language_">self</span>.b) % <span class="variable language_">self</span>.p == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, p1, p2</span>):</span><br><span class="line">        <span class="keyword">if</span> p1 <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> p2 <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> p1 <span class="keyword">if</span> p2 <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> p2</span><br><span class="line"></span><br><span class="line">        x1, y1 = p1</span><br><span class="line">        x2, y2 = p2</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> x1 == x2 <span class="keyword">and</span> y1 != y2:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> x1 == x2:</span><br><span class="line">            m = (<span class="number">3</span> * x1 * x1 + <span class="variable language_">self</span>.a) * <span class="built_in">pow</span>(<span class="number">2</span> * y1, -<span class="number">1</span>,  <span class="variable language_">self</span>.p) % <span class="variable language_">self</span>.p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            m = (y2 - y1) * <span class="built_in">pow</span>((x2 - x1) % <span class="variable language_">self</span>.p, -<span class="number">1</span>, <span class="variable language_">self</span>.p) % <span class="variable language_">self</span>.p</span><br><span class="line">        </span><br><span class="line">        x3 = (m * m - x1 - x2) % <span class="variable language_">self</span>.p</span><br><span class="line">        y3 = (m * (x1 - x3) - y1) % <span class="variable language_">self</span>.p</span><br><span class="line">        <span class="keyword">return</span> (x3, y3)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">self, k:<span class="built_in">int</span>, P:<span class="built_in">tuple</span>[<span class="built_in">int</span>,<span class="built_in">int</span>]</span>):</span><br><span class="line">        <span class="keyword">if</span> P <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">        R = <span class="literal">None</span>        </span><br><span class="line">        <span class="keyword">while</span> k &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> k &amp; <span class="number">1</span>:</span><br><span class="line">                R = <span class="variable language_">self</span>.add(R, P)</span><br><span class="line">            P = <span class="variable language_">self</span>.add(P,P)</span><br><span class="line">            k &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> R</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_key_pair</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.d,<span class="variable language_">self</span>.Q</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            k = randint(<span class="number">1</span>, <span class="variable language_">self</span>.n - <span class="number">1</span>)</span><br><span class="line">            P = <span class="variable language_">self</span>.mul(k, <span class="variable language_">self</span>.G)</span><br><span class="line">            <span class="keyword">if</span> P <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            r = P[<span class="number">0</span>] % <span class="variable language_">self</span>.n</span><br><span class="line">            <span class="keyword">if</span> r == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            s = (<span class="built_in">pow</span>(k,-<span class="number">1</span>,<span class="variable language_">self</span>.n) * (<span class="built_in">int</span>.from_bytes(sha256(message).digest())+ <span class="variable language_">self</span>.d * r)) % <span class="variable language_">self</span>.n</span><br><span class="line">            <span class="keyword">if</span> s != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> (r, s)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">self, m:<span class="built_in">bytes</span>, r:<span class="built_in">int</span>,s:<span class="built_in">int</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">1</span> &lt;= r &lt; <span class="variable language_">self</span>.n <span class="keyword">and</span> <span class="number">1</span> &lt;= s &lt; <span class="variable language_">self</span>.n):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        u1 = (<span class="built_in">int</span>.from_bytes(sha256(m).digest()) * <span class="built_in">pow</span>(s,-<span class="number">1</span>,<span class="variable language_">self</span>.n)) % <span class="variable language_">self</span>.n</span><br><span class="line">        u2 = (r * <span class="built_in">pow</span>(s,-<span class="number">1</span>,<span class="variable language_">self</span>.n)) % <span class="variable language_">self</span>.n</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> u1 == <span class="number">0</span> <span class="keyword">or</span> u2 == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        P = <span class="variable language_">self</span>.add(<span class="variable language_">self</span>.mul(u1, <span class="variable language_">self</span>.G), <span class="variable language_">self</span>.mul(u2, <span class="variable language_">self</span>.Q))        </span><br><span class="line">        <span class="keyword">return</span> P[<span class="number">0</span>] % <span class="variable language_">self</span>.n == r</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RSA</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,d:<span class="built_in">int</span></span>):</span><br><span class="line">        p = getStrongPrime(<span class="number">1024</span>)</span><br><span class="line">        q = getStrongPrime(<span class="number">1024</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">assert</span> GCD(d,(p-<span class="number">1</span>)*(q-<span class="number">1</span>)) == <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.N = p * q</span><br><span class="line">        <span class="variable language_">self</span>.d = d</span><br><span class="line">        <span class="variable language_">self</span>.e = <span class="built_in">pow</span>(d,-<span class="number">1</span>,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self,m:<span class="built_in">int</span>,idx:<span class="built_in">int</span></span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">pow</span>(m,<span class="variable language_">self</span>.e ^ (<span class="number">1</span> &lt;&lt; idx),<span class="variable language_">self</span>.N)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>():</span><br><span class="line">    r,s = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>,<span class="built_in">input</span>(<span class="string">&#x27;Give me your signature:&#x27;</span>).split()))</span><br><span class="line">    <span class="keyword">if</span> e.verify(<span class="string">f&#x27;nctf2024-<span class="subst">&#123;urandom(<span class="number">1</span>).<span class="built_in">hex</span>()&#125;</span>&#x27;</span>.encode(),r,s):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Congratulations! Here is your flag: <span class="subst">&#123;getenv(<span class="string">&quot;FLAG&quot;</span>)&#125;</span>&#x27;</span>)</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Wrong!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    e = ECDSA()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Can you navigate yourself through QiYun Valley with only the encryption orcale?&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    menu = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">--- Menu ---</span></span><br><span class="line"><span class="string">[1] Initialize encryption orcale</span></span><br><span class="line"><span class="string">[2] Check your signature</span></span><br><span class="line"><span class="string">[3] Exit&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(menu)</span><br><span class="line">        opt = <span class="built_in">input</span>(<span class="string">&#x27;Your option:&#x27;</span>).strip()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> opt==<span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Generating new public key pair for you...&#x27;</span>)</span><br><span class="line">            rsa = RSA(e.d ** <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> <span class="built_in">input</span>(<span class="string">&quot;Enter &#x27;e&#x27; for encryption or other to exit:&quot;</span>).strip() == <span class="string">&quot;e&quot;</span>:</span><br><span class="line">                m = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;Enter your message:&#x27;</span>),<span class="number">16</span>)</span><br><span class="line">                x = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;Where do you want to interfere?&#x27;</span>))</span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;Result:<span class="subst">&#123;<span class="built_in">hex</span>(rsa.encrypt(m,x))[<span class="number">2</span>:]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> opt==<span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">            check()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">elif</span> opt==<span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Bye~&#x27;</span>)</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Invalid option&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>题目分为了两部分，第一部分是通过 RSA 来获取 ECDSA 的私钥，第二部分是利用 ECDSA 的私钥来爆破消息的签名。</p>
<p>首先看第一部分，题目给出了一个 RSA 但是并没有给出其的任何公钥，所以我们肯定要先恢复 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">e</span></span></span></span>。</p>
<p>恢复 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span> 是简单的，我们只要发送多个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">x^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> 即可。然后我们看恢复 e，这个 RSA 每次加密时我们可以指定一个 bit 发生翻转。也就是说我们有</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>m</mi><mrow><mi>e</mi><mo>±</mo><msup><mn>2</mn><mi>i</mi></msup></mrow></msup><mo>≡</mo><msup><mi>c</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">m^{e\pm2^i}\equiv c&#x27;\mod n
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04446em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.04446em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="mbin mtight">±</span><span class="mord mtight"><span class="mord mtight">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9020857142857143em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.801892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span></span></span></span></span></p>
<p>我们固定 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span></span></span></span> 不动，并且直接假设 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">e</span></span></span></span> 的最低位为1(虽然的确如此)，那么我们是知道 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mi>e</mi></msup><mo>≡</mo><mi>c</mi><mspace></mspace><mspace width="0.6666666666666666em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">m^e\equiv c\mod n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">c</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6666666666666666em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span></span></span></span> 的。我们可以通过验证 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>c</mi><mrow><mo mathvariant="normal">′</mo><mrow><mo>±</mo><msup><mn>2</mn><mi>i</mi></msup></mrow></mrow></msup><mo>≡</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">c&#x27;^{\pm2^i}\equiv c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9944599999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9944599999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight"><span class="mord mtight">±</span><span class="mord mtight"><span class="mord mtight">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9020857142857143em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">c</span></span></span></span> 是否成立即可，然后 bit by bit 的恢复出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">e</span></span></span></span>。</p>
<p>然后我们下一步就是恢复私钥了，我们可以发现对于不同的 RSA 公钥都用了相同的私钥，故我们可以考虑共私钥攻击，实测取10个 RSA 的数据即可恢复。</p>
<p>最后就是 ECDSA 了，不过所有参数都有了直接爆破就好了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line"><span class="comment"># preparatory work</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ch</span>(<span class="params">c:<span class="built_in">int</span></span>):</span><br><span class="line">    c = <span class="built_in">str</span>(c).encode()</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        a = r.recvline()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;Exit&#x27;</span> <span class="keyword">in</span> a:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;Your option:&#x27;</span>, c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># r = process([&#x27;python&#x27;, &#x27;chal.py&#x27;])</span></span><br><span class="line">r = remote(<span class="string">&#x27;39.106.16.204&#x27;</span>, <span class="number">55066</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># solve n and e</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_</span>(<span class="params">m, x=<span class="number">0</span>, n=<span class="literal">True</span></span>):</span><br><span class="line">    r.sendlineafter(<span class="string">b&quot;Enter &#x27;e&#x27; for encryption or other to exit:&quot;</span>, <span class="string">b&#x27;e&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;Enter your message:&#x27;</span>, <span class="built_in">hex</span>(m)[<span class="number">2</span>:])</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;Where do you want to interfere?&#x27;</span>, <span class="built_in">str</span>(x).encode())</span><br><span class="line">    c_ = <span class="built_in">int</span>(r.recvline().decode().split(<span class="string">&#x27;:&#x27;</span>)[-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">    c = c_ * m</span><br><span class="line">    <span class="keyword">if</span> n: <span class="keyword">return</span> c</span><br><span class="line">    <span class="keyword">else</span>: <span class="keyword">return</span> c_</span><br><span class="line"></span><br><span class="line">N = []; E = []</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    ch(<span class="number">1</span>)</span><br><span class="line">    r.recvline()</span><br><span class="line">    m = <span class="number">1337</span>; m2 = <span class="number">1337</span> ** <span class="number">2</span>; m3 = <span class="number">727</span>; m4 = <span class="number">727</span> ** <span class="number">2</span>; m5 = <span class="number">114514</span>; m6 = <span class="number">114514</span> ** <span class="number">2</span>; m7 = <span class="number">12345678</span>; m8 = <span class="number">12345678</span> ** <span class="number">2</span></span><br><span class="line">    c = solve_(m); c2 = solve_(m2); c3 = solve_(m3); c4 = solve_(m4); c5 = solve_(m5); c6 = solve_(m6); c7 = solve_(m7); c8 = solve_(m8)</span><br><span class="line">    n = GCD(c ** <span class="number">2</span> - c2, c3 ** <span class="number">2</span> - c4)</span><br><span class="line">    n = GCD(n, c5 ** <span class="number">2</span> - c6)</span><br><span class="line">    n = GCD(n, c7 ** <span class="number">2</span> - c8)</span><br><span class="line">    e_1, x = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> (x:= x + <span class="number">1</span>) <span class="keyword">and</span> x &lt;= <span class="number">2048</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;x = <span class="subst">&#123;x&#125;</span>&#x27;</span>)</span><br><span class="line">        c_ = solve_(m, x, n=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> [-<span class="number">1</span>, <span class="number">1</span>]:</span><br><span class="line">            c__ = c_ * <span class="built_in">pow</span>(m, i * <span class="number">2</span>**x, n) % n</span><br><span class="line">            <span class="keyword">if</span> c__ == c % n:</span><br><span class="line">                e_1 += (i + <span class="number">1</span>) // <span class="number">2</span> &lt;&lt; x</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">pow</span>(m, e_1, n) == c % n:</span><br><span class="line">        e = e_1; N.append(n); E.append(e)</span><br><span class="line">    <span class="keyword">else</span>: <span class="built_in">print</span>(<span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;len = <span class="subst">&#123;<span class="built_in">len</span>(N)&#125;</span>&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">b&quot;Enter &#x27;e&#x27; for encryption or other to exit:&quot;</span>, <span class="string">b&#x27;x&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(N) == <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># solve d</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_d</span>(<span class="params">N, E</span>):</span><br><span class="line">    M = matrix(<span class="built_in">len</span>(N)+<span class="number">1</span>)</span><br><span class="line">    D = <span class="number">2</span> ** <span class="number">1024</span></span><br><span class="line">    M[<span class="number">0</span>, <span class="number">0</span>] = D</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(N) + <span class="number">1</span>):</span><br><span class="line">        M[i, i] = -N[i - <span class="number">1</span>]</span><br><span class="line">        M[<span class="number">0</span>, i] = E[i - <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    mm = M.LLL()</span><br><span class="line">    d_ = <span class="built_in">abs</span>(mm[<span class="number">0</span>][<span class="number">0</span>])//D</span><br><span class="line">    <span class="keyword">return</span> d_</span><br><span class="line"></span><br><span class="line">d = sqrt(sqrt(solve_d(N, E)))</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># solve flag</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ECDSA</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, d</span>):</span><br><span class="line">        <span class="variable language_">self</span>.p = <span class="number">0xFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFF</span></span><br><span class="line">        <span class="variable language_">self</span>.a = <span class="number">0xFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC</span></span><br><span class="line">        <span class="variable language_">self</span>.b = <span class="number">0x28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93</span></span><br><span class="line">        <span class="variable language_">self</span>.n = <span class="number">0xFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123</span></span><br><span class="line">        <span class="variable language_">self</span>.Gx = <span class="number">0x32C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7</span></span><br><span class="line">        <span class="variable language_">self</span>.Gy = <span class="number">0xBC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0</span></span><br><span class="line">        <span class="variable language_">self</span>.G = (<span class="variable language_">self</span>.Gx,<span class="variable language_">self</span>.Gy)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.d = d</span><br><span class="line">        <span class="variable language_">self</span>.Q = <span class="variable language_">self</span>.mul(<span class="variable language_">self</span>.d,<span class="variable language_">self</span>.G)</span><br><span class="line">        <span class="keyword">assert</span> <span class="variable language_">self</span>.is_on_curve(<span class="variable language_">self</span>.Q)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_on_curve</span>(<span class="params">self, point</span>):</span><br><span class="line">        <span class="keyword">if</span> point <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        x, y = point</span><br><span class="line">        <span class="keyword">return</span> (y**<span class="number">2</span> - x**<span class="number">3</span> - <span class="variable language_">self</span>.a * x - <span class="variable language_">self</span>.b) % <span class="variable language_">self</span>.p == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, p1, p2</span>):</span><br><span class="line">        <span class="keyword">if</span> p1 <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> p2 <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> p1 <span class="keyword">if</span> p2 <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> p2</span><br><span class="line"></span><br><span class="line">        x1, y1 = p1</span><br><span class="line">        x2, y2 = p2</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> x1 == x2 <span class="keyword">and</span> y1 != y2:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> x1 == x2:</span><br><span class="line">            m = (<span class="number">3</span> * x1 * x1 + <span class="variable language_">self</span>.a) * <span class="built_in">pow</span>(<span class="number">2</span> * y1, -<span class="number">1</span>,  <span class="variable language_">self</span>.p) % <span class="variable language_">self</span>.p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            m = (y2 - y1) * <span class="built_in">pow</span>((x2 - x1) % <span class="variable language_">self</span>.p, -<span class="number">1</span>, <span class="variable language_">self</span>.p) % <span class="variable language_">self</span>.p</span><br><span class="line">        </span><br><span class="line">        x3 = (m * m - x1 - x2) % <span class="variable language_">self</span>.p</span><br><span class="line">        y3 = (m * (x1 - x3) - y1) % <span class="variable language_">self</span>.p</span><br><span class="line">        <span class="keyword">return</span> (x3, y3)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">self, k:<span class="built_in">int</span>, P:<span class="built_in">tuple</span>[<span class="built_in">int</span>,<span class="built_in">int</span>]</span>):</span><br><span class="line">        <span class="keyword">if</span> P <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">        R = <span class="literal">None</span>        </span><br><span class="line">        <span class="keyword">while</span> k &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> k &amp; <span class="number">1</span>:</span><br><span class="line">                R = <span class="variable language_">self</span>.add(R, P)</span><br><span class="line">            P = <span class="variable language_">self</span>.add(P,P)</span><br><span class="line">            k &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> R</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_key_pair</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.d,<span class="variable language_">self</span>.Q</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            k = randint(<span class="number">1</span>, <span class="variable language_">self</span>.n - <span class="number">1</span>)</span><br><span class="line">            P = <span class="variable language_">self</span>.mul(k, <span class="variable language_">self</span>.G)</span><br><span class="line">            <span class="keyword">if</span> P <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            r = P[<span class="number">0</span>] % <span class="variable language_">self</span>.n</span><br><span class="line">            <span class="keyword">if</span> r == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            s = (<span class="built_in">pow</span>(k,-<span class="number">1</span>,<span class="variable language_">self</span>.n) * (<span class="built_in">int</span>.from_bytes(sha256(message).digest())+ <span class="variable language_">self</span>.d * r)) % <span class="variable language_">self</span>.n</span><br><span class="line">            <span class="keyword">if</span> s != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> (r, s)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">self, m:<span class="built_in">bytes</span>, r:<span class="built_in">int</span>,s:<span class="built_in">int</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">1</span> &lt;= r &lt; <span class="variable language_">self</span>.n <span class="keyword">and</span> <span class="number">1</span> &lt;= s &lt; <span class="variable language_">self</span>.n):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        u1 = (<span class="built_in">int</span>.from_bytes(sha256(m).digest()) * <span class="built_in">pow</span>(s,-<span class="number">1</span>,<span class="variable language_">self</span>.n)) % <span class="variable language_">self</span>.n</span><br><span class="line">        u2 = (r * <span class="built_in">pow</span>(s,-<span class="number">1</span>,<span class="variable language_">self</span>.n)) % <span class="variable language_">self</span>.n</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> u1 == <span class="number">0</span> <span class="keyword">or</span> u2 == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        P = <span class="variable language_">self</span>.add(<span class="variable language_">self</span>.mul(u1, <span class="variable language_">self</span>.G), <span class="variable language_">self</span>.mul(u2, <span class="variable language_">self</span>.Q))        </span><br><span class="line">        <span class="keyword">return</span> P[<span class="number">0</span>] % <span class="variable language_">self</span>.n == r</span><br><span class="line"></span><br><span class="line">dsa = ECDSA(<span class="built_in">int</span>(d))</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        ch(<span class="number">2</span>)</span><br><span class="line">        msg = <span class="string">f&#x27;nctf2024-<span class="subst">&#123;<span class="built_in">hex</span>(i)[<span class="number">2</span>:].zfill(<span class="number">2</span>)&#125;</span>&#x27;</span>.encode()</span><br><span class="line">        rr, ss = dsa.sign(msg)</span><br><span class="line">        r.sendlineafter(<span class="string">b&#x27;Give me your signature:&#x27;</span>, <span class="built_in">str</span>(rr).encode() + <span class="string">b&#x27; &#x27;</span> + <span class="built_in">str</span>(ss).encode())</span><br><span class="line">        a = r.recvline()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;Wrong!&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> a:</span><br><span class="line">            <span class="built_in">print</span>(a)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure>
<h3 id="sign"><a class="markdownIt-Anchor" href="#sign"></a> Sign</h3>
<p>题目</p>
<p><a target="_blank" rel="noopener" href="http://util.py">util.py</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getrandint</span>(<span class="params">n:<span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>.from_bytes(urandom(n//<span class="number">8</span>+<span class="number">1</span>)) % <span class="built_in">pow</span>(<span class="number">2</span>,n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FHE</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.p = getPrime(<span class="number">77</span>)</span><br><span class="line">        <span class="variable language_">self</span>.pubkeys = []</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">            <span class="variable language_">self</span>.pubkeys.append(<span class="variable language_">self</span>.p * getrandint(<span class="number">177</span>) + (getrandint(<span class="number">17</span>) &lt;&lt; <span class="number">8</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self,msg:<span class="built_in">list</span>[<span class="built_in">int</span>] | <span class="built_in">bytes</span></span>):</span><br><span class="line">        result = []</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> msg:</span><br><span class="line">            tmp = <span class="number">0</span></span><br><span class="line">            shuffle_base = urandom(<span class="number">16</span>)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> shuffle_base:</span><br><span class="line">                x,y = <span class="built_in">divmod</span>(i,<span class="number">16</span>)</span><br><span class="line">                tmp += x*<span class="variable language_">self</span>.pubkeys[y] + y*<span class="variable language_">self</span>.pubkeys[x]</span><br><span class="line">            result.append(tmp + m)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://srv.py">srv.py</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> util <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> getenv</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> Random</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">string = <span class="built_in">open</span>(<span class="string">&#x27;secret.txt&#x27;</span>).read().strip().encode()</span><br><span class="line">flag = getenv(<span class="string">&#x27;FLAG&#x27;</span>).encode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    Keys = []</span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> string:</span><br><span class="line">        f = FHE()</span><br><span class="line">        s = long_to_bytes(Random().getrandbits(<span class="number">20000</span>))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> s[<span class="number">4</span>:]:</span><br><span class="line">            Keys.extend(f.encrypt([i]))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> s[:<span class="number">4</span>]:</span><br><span class="line">            Keys.extend(f.encrypt([i * (m &amp; <span class="number">0x03</span>) % <span class="number">0x101</span>]))</span><br><span class="line">            m &gt;&gt;= <span class="number">2</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(Keys) == <span class="number">30000</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;[+] Your ciphertext: <span class="subst">&#123;AES.new(md5(string).digest(),AES.MODE_ECB).encrypt(pad(flag,<span class="number">16</span>)).<span class="built_in">hex</span>()&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">input</span>(<span class="string">f&#x27;[+] The keys to retrieve the global internet connection are as follows:&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30000</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;[+] <span class="subst">&#123;Keys[i]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>FHE 是基于 AGCD 的，然后私钥又很小故可以直接用格打出来。然后 s 是用MT19937生成的，我们可以直接来预测。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> agcd_attack <span class="keyword">import</span> attack</span><br><span class="line"><span class="keyword">from</span> output <span class="keyword">import</span> output</span><br><span class="line"><span class="keyword">from</span> gf2bv <span class="keyword">import</span> LinearSystem</span><br><span class="line"><span class="keyword">from</span> gf2bv.crypto.mt <span class="keyword">import</span> MT19937</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mt19937</span>(<span class="params">out</span>):</span><br><span class="line">    lin = LinearSystem([<span class="number">32</span>] * <span class="number">624</span>)</span><br><span class="line">    mt = lin.gens()</span><br><span class="line"></span><br><span class="line">    rng = MT19937(mt)</span><br><span class="line">    zeros = []</span><br><span class="line">    zeros.append(rng.getrandbits(<span class="number">19968</span>) ^ <span class="built_in">int</span>(out))</span><br><span class="line">    zeros.append(mt[<span class="number">0</span>] ^ <span class="built_in">int</span>(<span class="number">0x80000000</span>))</span><br><span class="line">    sol = lin.solve_one(zeros)</span><br><span class="line">    rng = MT19937(sol)</span><br><span class="line">    pyrand = rng.to_python_random()</span><br><span class="line">    <span class="keyword">return</span> pyrand</span><br><span class="line"></span><br><span class="line"><span class="comment"># solve rng</span></span><br><span class="line">block = <span class="number">2500</span></span><br><span class="line">c = [output[i * block : i * block + block] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(output) // block)]</span><br><span class="line">rngs = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="built_in">len</span>(c)):</span><br><span class="line">    out = c[i]</span><br><span class="line">    cc = out[:<span class="number">10</span>]</span><br><span class="line">    p = attack(cc, <span class="number">30</span>)</span><br><span class="line">    cf = out[:-<span class="number">4</span>]</span><br><span class="line">    u = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> cf:</span><br><span class="line">        u.append(i % p % <span class="number">256</span>)</span><br><span class="line">    m = bytes_to_long(<span class="built_in">bytes</span>([<span class="number">0</span>] * <span class="number">4</span> + u))</span><br><span class="line">    rng = mt19937(m)</span><br><span class="line">    rngs.append(rng)</span><br><span class="line"></span><br><span class="line"><span class="comment"># solve key</span></span><br><span class="line">ms = []</span><br><span class="line">iii = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> out <span class="keyword">in</span> c:</span><br><span class="line">    s = long_to_bytes(rngs[iii].getrandbits(<span class="number">20000</span>))</span><br><span class="line">    cc = out[:<span class="number">10</span>]</span><br><span class="line">    p = attack(cc, <span class="number">30</span>)</span><br><span class="line">    cf = out[-<span class="number">4</span>:]</span><br><span class="line">    u = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> cf:</span><br><span class="line">        u.append(i % p % <span class="number">256</span>)</span><br><span class="line">    ss = [i <span class="keyword">for</span> i <span class="keyword">in</span> s[:<span class="number">4</span>]]</span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">all</span>(ss[i] * ((m &gt;&gt; <span class="number">2</span> * i) &amp; <span class="number">0x03</span>) % <span class="number">0x101</span> == u[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)):</span><br><span class="line">            ms.append(m)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(ms)</span><br><span class="line">    iii += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># solve flag</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">enc = <span class="string">&#x27;b76796081756e51e16e937ee2c6b913327cfc2b3008241e9b0b9387e908cfaf1f62d73bcdd98c670b6f84f22d94523c0&#x27;</span></span><br><span class="line">String = <span class="built_in">bytes</span>(ms)</span><br><span class="line"><span class="built_in">print</span>(AES.new(md5(String).digest(),AES.MODE_ECB).decrypt(<span class="built_in">bytes</span>.fromhex(enc)))</span><br></pre></td></tr></table></figure>
<p>agcd_attack.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://github.com/jvdsn/crypto-attacks/blob/master/attacks/acd/ol.py</span></span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">symmetric_mod</span>(<span class="params">x, m</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>((x + m + m // <span class="number">2</span>) % m) - <span class="built_in">int</span>(m // <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">x, rho</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(x) &gt;= <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    R = <span class="number">2</span> ** rho</span><br><span class="line"></span><br><span class="line">    B = matrix(ZZ, <span class="built_in">len</span>(x), <span class="built_in">len</span>(x) + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> i, xi <span class="keyword">in</span> <span class="built_in">enumerate</span>(x):</span><br><span class="line">        B[i, <span class="number">0</span>] = xi</span><br><span class="line">        B[i, i + <span class="number">1</span>] = R</span><br><span class="line"></span><br><span class="line">    B = B.LLL()</span><br><span class="line"></span><br><span class="line">    K = B.submatrix(row=<span class="number">0</span>, col=<span class="number">1</span>, nrows=<span class="built_in">len</span>(x) - <span class="number">1</span>, ncols=<span class="built_in">len</span>(x)).right_kernel()</span><br><span class="line">    q = K.an_element()</span><br><span class="line">    r0 = symmetric_mod(x[<span class="number">0</span>], q[<span class="number">0</span>])</span><br><span class="line">    p = <span class="built_in">abs</span>((x[<span class="number">0</span>] - r0) // q[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(p)</span><br></pre></td></tr></table></figure>
<h3 id="arcahv"><a class="markdownIt-Anchor" href="#arcahv"></a> Arcahv</h3>
<p>题目</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom,getenv</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCG</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,seed:<span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="variable language_">self</span>.p = getPrime(<span class="number">1024</span>)</span><br><span class="line">        <span class="variable language_">self</span>.a = getPrime(<span class="number">1023</span>)</span><br><span class="line">        <span class="variable language_">self</span>.b = getPrime(<span class="number">1023</span>)</span><br><span class="line">        <span class="variable language_">self</span>.status = seed</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        ret = <span class="variable language_">self</span>.status</span><br><span class="line">        <span class="variable language_">self</span>.status = (<span class="variable language_">self</span>.status * <span class="variable language_">self</span>.a + <span class="variable language_">self</span>.b) % <span class="variable language_">self</span>.p</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crystal_trick</span>(<span class="params">m:<span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    m = <span class="built_in">bytearray</span>(m)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(m)):</span><br><span class="line">        m[i] = reduce(<span class="keyword">lambda</span> x,y: x^y^urandom(<span class="number">1</span>)[<span class="number">0</span>],m[:i],m[i])</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RSA</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        p = getStrongPrime(<span class="number">1024</span>)</span><br><span class="line">        q = getStrongPrime(<span class="number">1024</span>)</span><br><span class="line">        <span class="variable language_">self</span>.p = p</span><br><span class="line">        <span class="variable language_">self</span>.N = p * q</span><br><span class="line">        <span class="variable language_">self</span>.e = <span class="number">65537</span></span><br><span class="line">        <span class="variable language_">self</span>.d = <span class="built_in">pow</span>(<span class="variable language_">self</span>.e, -<span class="number">1</span>, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self,m:<span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">pow</span>(m,<span class="variable language_">self</span>.e,<span class="variable language_">self</span>.N)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">self,c:<span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">pow</span>(c,<span class="variable language_">self</span>.d,<span class="variable language_">self</span>.N) </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyRSA1</span>(<span class="title class_ inherited__">RSA</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self,m:<span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().encrypt(<span class="built_in">int</span>.from_bytes(m)).to_bytes(<span class="number">256</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">self,c:<span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().decrypt(<span class="built_in">int</span>.from_bytes(c)).to_bytes(<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyRSA2</span>(<span class="title class_ inherited__">RSA</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self,m:<span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">pow</span>(<span class="built_in">int</span>.from_bytes(m),<span class="variable language_">self</span>.e,<span class="variable language_">self</span>.N).to_bytes(<span class="number">256</span>,<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">self,c:<span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        m = <span class="built_in">pow</span>(<span class="built_in">int</span>.from_bytes(c),<span class="variable language_">self</span>.d,<span class="variable language_">self</span>.N).to_bytes(<span class="number">256</span>,<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Hibiscus is here to trick your decryption result!!&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> crystal_trick(m)</span><br><span class="line"></span><br><span class="line">menu = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Welcome to NCTF 2025 arcahv challenge!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">--- Menu ---</span></span><br><span class="line"><span class="string">[1] View encrypted flag and hint</span></span><br><span class="line"><span class="string">[2] Play with the decryption orcale</span></span><br><span class="line"><span class="string">[3] Get some random numbers for fun</span></span><br><span class="line"><span class="string">[4] Exit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Your Option &gt; &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Loading, please wait...&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># flag = open(&#x27;flag.txt&#x27;).read().strip().encode()</span></span><br><span class="line">    flag = getenv(<span class="string">&#x27;FLAG&#x27;</span>).encode()</span><br><span class="line">    attempts = <span class="number">75</span></span><br><span class="line">    r1 = MyRSA1()</span><br><span class="line">    r2 = MyRSA2()</span><br><span class="line">    hint1 = r2.encrypt(r1.p.to_bytes(<span class="number">128</span>))</span><br><span class="line"></span><br><span class="line">    key = urandom(<span class="number">16</span>)</span><br><span class="line">    hint2 = AES.new(key,AES.MODE_ECB).encrypt(r1.N.to_bytes(<span class="number">256</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">flag_and_hint</span>():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Encrypted flag: <span class="subst">&#123;r1.encrypt(flag).<span class="built_in">hex</span>()&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Hint1: <span class="subst">&#123;hint1.<span class="built_in">hex</span>()&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Hint2: <span class="subst">&#123;hint2.<span class="built_in">hex</span>()&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">rsachal</span>(): </span><br><span class="line">        <span class="keyword">global</span> attempts</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Since you didn&#x27;t v Hibiscus 50 on crazy thursday, Hibiscus decided to do some trick on your decryption result!&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Your pubkey:(<span class="subst">&#123;<span class="built_in">hex</span>(r2.N)[<span class="number">2</span>:]&#125;</span>,<span class="subst">&#123;<span class="built_in">hex</span>(r2.e)[<span class="number">2</span>:]&#125;</span>)&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> attempts &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">input</span>(<span class="string">&#x27;Do you still want to try decryption(y/[n])?&#x27;</span>) != <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            c = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">f&#x27;You have <span class="subst">&#123;attempts&#125;</span> remaining access to decryption orcale!\nYour ciphertext(in hex):&#x27;</span>))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;Result: <span class="subst">&#123;r2.decrypt(c).<span class="built_in">hex</span>()&#125;</span>&#x27;</span>)</span><br><span class="line">            attempts -= <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> attempts == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Unfortunately, you are out of decryption attempts! Come back again on nctf2026 ~&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">lcgchal</span>():</span><br><span class="line">        lcg = LCG(<span class="built_in">int</span>.from_bytes(key))</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Tempering with LCG generator, please wait...&#x27;</span>)</span><br><span class="line">        <span class="keyword">while</span> urandom(<span class="number">1</span>)[<span class="number">0</span>] &amp; <span class="number">0xff</span>:</span><br><span class="line">            lcg.<span class="built_in">next</span>()</span><br><span class="line">        </span><br><span class="line">        hexnums = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">hex</span>(lcg.<span class="built_in">next</span>())[<span class="number">2</span>:] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>))</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(hexnums) % <span class="number">16</span>:</span><br><span class="line">            hexnums = hexnums.zfill((<span class="built_in">len</span>(hexnums) // <span class="number">16</span> + <span class="number">1</span>) * <span class="number">16</span>)</span><br><span class="line">        </span><br><span class="line">        idx = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">input</span>(<span class="string">&#x27;Do you want another unsigned long long number(y/[n])?&#x27;</span>) == <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(hexnums[idx:idx+<span class="number">16</span>]),<span class="number">16</span>))</span><br><span class="line">            idx = (idx + <span class="number">16</span>) % <span class="built_in">len</span>(hexnums)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bye</span>():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Hope you have fun during the challenge XD:)&#x27;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    fundc = &#123;<span class="number">1</span>:flag_and_hint,<span class="number">2</span>:rsachal,<span class="number">3</span>:lcgchal,<span class="number">4</span>:bye&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        opt = <span class="built_in">input</span>(menu)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(opt) == <span class="number">0</span> <span class="keyword">or</span> opt <span class="keyword">not</span> <span class="keyword">in</span> <span class="string">&#x27;1234&#x27;</span>:</span><br><span class="line">            opt = <span class="string">&#x27;4&#x27;</span></span><br><span class="line">        fundc[<span class="built_in">int</span>(opt)]()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>题目分为两个部分，第一部分是解 RSA2 拿到 RSA1 的 p 高位，第二部分是解 LCG 的参数来拿到 RSA1 的 n，然后解 RSA1 拿 flag。</p>
<p>先看 LCG 的部分，给出了5组数据直接就可以恢复参数了，这个没啥好说的。</p>
<p>然后看 RSA2 的部分，它在解密的时候做了一个混淆，混淆的方式如下：</p>
<ul>
<li>假如输入的字符串为 <strong>abc</strong>，那么输出为 <strong>a|a xor b xor 未知|a xor b xor c xor 未知</strong></li>
</ul>
<p>其实可以发现这个就类似 MSB Oracle Attack，具体可以看 solver。</p>
<p>然后这个是不能解出完整的 p 的，只能解出大概 584 位的高位，但是打 copper 已经绰绰有余。</p>
<p>拿到后解个 RSA 就得到 flag 了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> fractions <span class="keyword">import</span> Fraction</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># preparatory work</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ch</span>(<span class="params">c:<span class="built_in">int</span></span>):</span><br><span class="line">    c = <span class="built_in">str</span>(c).encode()</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        a = r.recvline()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;Exit&#x27;</span> <span class="keyword">in</span> a:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;Your Option &gt; &#x27;</span>, c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># r = process([&#x27;python&#x27;, &#x27;chal.py&#x27;])</span></span><br><span class="line">r = remote(<span class="string">&#x27;39.106.16.204&#x27;</span>, <span class="number">39702</span>)</span><br><span class="line">ch(<span class="number">1</span>)</span><br><span class="line">enc_flag = <span class="built_in">int</span>(r.recvline().strip().split(<span class="string">b&#x27;: &#x27;</span>)[-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">hint1 = r.recvline().strip().split(<span class="string">b&#x27;: &#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">hint2 = <span class="built_in">bytes</span>.fromhex(r.recvline().strip().split(<span class="string">b&#x27;: &#x27;</span>)[-<span class="number">1</span>].decode())</span><br><span class="line"></span><br><span class="line"><span class="comment"># solve lcg</span></span><br><span class="line">ch(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">output</span>):</span><br><span class="line">    t=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(output)-<span class="number">1</span>):</span><br><span class="line">        t.append(output[i+<span class="number">1</span>]-output[i])</span><br><span class="line">    j=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(t)-<span class="number">3</span>):</span><br><span class="line">        j.append(GCD((t[i+<span class="number">2</span>]*t[i]-t[i+<span class="number">1</span>]*t[i+<span class="number">1</span>]), (t[i+<span class="number">3</span>]*t[i+<span class="number">1</span>]-t[i+<span class="number">2</span>]*t[i+<span class="number">2</span>])))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isPrime(j[<span class="number">0</span>]):</span><br><span class="line">        m = <span class="built_in">list</span>(factor(j[<span class="number">0</span>]))[-<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">else</span>:m = j[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;p = <span class="subst">&#123;m&#125;</span>&#x27;</span>)</span><br><span class="line">    a=(output[<span class="number">2</span>]-output[<span class="number">1</span>])*inverse(output[<span class="number">1</span>]-output[<span class="number">0</span>],m)%m</span><br><span class="line">    b=(output[<span class="number">1</span>]-a*output[<span class="number">0</span>])%m</span><br><span class="line">    <span class="keyword">if</span> isPrime(a) <span class="keyword">and</span> isPrime(b) <span class="keyword">and</span> isPrime(m):</span><br><span class="line">        <span class="keyword">return</span> a, b, m</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">output = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">80</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;Do you want another unsigned long long number(y/[n])?&#x27;</span>, <span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line">    output.append(<span class="built_in">int</span>(r.recvline()))</span><br><span class="line">hexnums = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">hex</span>(i)[<span class="number">2</span>:].zfill((j:=<span class="built_in">len</span>(<span class="built_in">hex</span>(i)[<span class="number">2</span>:])) + j % <span class="number">2</span>) <span class="keyword">for</span> i <span class="keyword">in</span> output)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(hexnums) % <span class="number">16</span>:</span><br><span class="line">    hexnums = hexnums.zfill((<span class="built_in">len</span>(hexnums) // <span class="number">16</span> + <span class="number">1</span>) * <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">bits = <span class="built_in">len</span>(hexnums) // <span class="number">5</span></span><br><span class="line">out = [<span class="built_in">int</span>(hexnums[bits * i : bits * i + bits], <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">aa, bb, pp = solve(out)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;p = <span class="subst">&#123;pp&#125;</span>, a = <span class="subst">&#123;aa&#125;</span>, b = <span class="subst">&#123;bb&#125;</span>&#x27;</span>)</span><br><span class="line">out = out[-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">555</span>):</span><br><span class="line">    key = long_to_bytes(out)</span><br><span class="line">    out = (out - bb) * inverse(aa, pp) % pp</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(key) == <span class="number">16</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;key = <span class="subst">&#123;key&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">N = bytes_to_long(AES.new(key,AES.MODE_ECB).decrypt(hint2))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;N = <span class="subst">&#123;N&#125;</span>&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;Do you want another unsigned long long number(y/[n])?&#x27;</span>, <span class="string">b&#x27;n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># solve p</span></span><br><span class="line">ch(<span class="number">2</span>)</span><br><span class="line">r.recvline()</span><br><span class="line">a=r.recvline().strip().split(<span class="string">b&#x27;:&#x27;</span>)[-<span class="number">1</span>].decode()</span><br><span class="line">N2=<span class="built_in">bytes</span>.fromhex(a[<span class="number">1</span>:-<span class="number">7</span>])</span><br><span class="line">e2=<span class="number">65537</span></span><br><span class="line">N2=bytes_to_long(N2)</span><br><span class="line"></span><br><span class="line">hint1=<span class="built_in">bytes</span>.fromhex(hint1.decode())</span><br><span class="line">hint1=<span class="built_in">int</span>.from_bytes(hint1,<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line"></span><br><span class="line">c=(hint1*<span class="built_in">pow</span>(<span class="number">2</span>,<span class="number">1016</span>*e2,N2))%N2</span><br><span class="line"></span><br><span class="line"><span class="built_in">map</span> = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">256</span>):</span><br><span class="line">    <span class="built_in">map</span>[-N2 * i % <span class="number">256</span>] = i</span><br><span class="line"></span><br><span class="line">cipher256 = <span class="built_in">pow</span>(<span class="number">256</span>,e2,N2)</span><br><span class="line">backup = hint1</span><br><span class="line"></span><br><span class="line">L = Fraction(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">R = Fraction(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">74</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">b&quot;Do you still want to try decryption(y/[n])?&quot;</span>,<span class="string">b&quot;y&quot;</span>)</span><br><span class="line">    c = c * cipher256 % N2</span><br><span class="line">    hex_c = <span class="built_in">hex</span>(c)[<span class="number">2</span>:]</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Your ciphertext(in hex):&quot;</span>,(hex_c.zfill(<span class="built_in">len</span>(hex_c) + <span class="built_in">len</span>(hex_c) % <span class="number">2</span>)).encode())</span><br><span class="line">    r.recvline()</span><br><span class="line">    m=r.recvline()[<span class="number">8</span>:-<span class="number">1</span>]</span><br><span class="line">    m=<span class="built_in">bytes</span>.fromhex(m.decode())</span><br><span class="line">    b=m[<span class="number">0</span>]</span><br><span class="line">    k = <span class="built_in">map</span>[b]</span><br><span class="line">    L, R = L + Fraction(k, <span class="number">256</span>**(i+<span class="number">1</span>)), L + Fraction(k+<span class="number">1</span>, <span class="number">256</span>**(i+<span class="number">1</span>))</span><br><span class="line">M = <span class="built_in">int</span>(L * N2)</span><br><span class="line">r.sendlineafter(<span class="string">b&quot;Do you still want to try decryption(y/[n])?&quot;</span>,<span class="string">b&quot;y&quot;</span>)</span><br><span class="line">r.recvline()</span><br><span class="line">r.sendlineafter(<span class="string">&quot;Your ciphertext(in hex):&quot;</span>,(<span class="built_in">hex</span>(backup)[<span class="number">2</span>:]).encode())</span><br><span class="line">r.recvline()</span><br><span class="line">m=r.recvline()[<span class="number">8</span>:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">m=<span class="built_in">bytes</span>.fromhex(m.decode())</span><br><span class="line">b=m[<span class="number">0</span>]</span><br><span class="line">mmm = M - M % <span class="number">256</span> + b</span><br><span class="line">ph = mmm &gt;&gt; (<span class="number">2048</span>-<span class="number">584</span>)</span><br><span class="line">ph &lt;&lt;= (<span class="number">1024</span>-<span class="number">576</span>)</span><br><span class="line"><span class="built_in">print</span>(ph)</span><br><span class="line">x = PolynomialRing(Zmod(N), <span class="string">&#x27;x&#x27;</span>).gen()</span><br><span class="line">f = ph + x</span><br><span class="line">pl = <span class="built_in">int</span>(f.small_roots(X = <span class="number">2</span>**<span class="number">448</span>, beta=<span class="number">0.4</span>)[<span class="number">0</span>])</span><br><span class="line">p = pl + ph</span><br><span class="line"><span class="keyword">assert</span> N % p == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># solve flag</span></span><br><span class="line">q = N // p</span><br><span class="line">d = inverse(<span class="number">65537</span>, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(<span class="built_in">int</span>(enc_flag), <span class="built_in">int</span>(d), <span class="built_in">int</span>(N))))</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/ctf/" rel="tag"><i class="fa fa-tag"></i> ctf</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/03/20/angstromCTF-2022/" rel="prev" title="ångstromCTF 2022">
                  <i class="fa fa-angle-left"></i> ångstromCTF 2022
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">languag3</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha256-UF1fgpAiu3tPJN/uCqEUHNe7pnr+QR0SQDNfgglgtcM=" crossorigin="anonymous">
  <script class="next-config" data-name="katex" type="application/json">{"copy_tex_js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js","integrity":"sha256-Us54+rSGDSTvIhKKUs4kygE2ipA0RXpWWh0/zLqw3bs="}}</script>
  <script src="/js/third-party/math/katex.js"></script>



</body>
</html>
